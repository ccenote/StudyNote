# Mysql

### 1. 数据库三大范式

数据库三大范式是指在关系数据库设计中，通过不断的分解关系，将数据的冗余和不一致性降到最低的三个规范化级别：

1. 第一范式（1NF）：要求每个属性都具有原子性，即属性不可再分解。
2. 第二范式（2NF）：在满足1NF的基础上，要求每个非主属性都完全依赖于主键，而不是依赖与主键的一部分。
3. 第三范式（3NF）：在满足2NF的基础上，要求每个非主属性都不依赖于其他非主属性，即不存在传递依赖关系。

应用三大范式可以避免数据冗余和不一致性，保证数据的完整性和稳定性。但是，在某些情况下，为了提高查询性能和减少数据的连接操作，可能需要在设计中违反范式规则。此时需要根据具体情况，进行权衡和取舍。

### 2. 数据库ACID特性

1. 原子性：事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用。
2. 一致性：执行事务前后，数据保持一致，例如转账业务中，无论事务是否成功，转账者和收款人的总额应该是不变的。
3. 隔离性：并发访问数据时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的。
4. 持久性：一个事务被提交之后，它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响。

### 3. 并发事务带来的问题

1. 数据一致性：由于多个事务同时访问同一个数据集合，可能会导致数据的不一致性。例如，一个事务读取了某个数据，另一个事务同时修改了这个数据，那么第一个事务在提交时就会出现数据不一致性。
2. 丢失修改：如果多个事务同时修改同一个数据，那么可能会出现其中一个事务的修改被另一个事务覆盖的情况，从而导致数据的丢失。
3. 死锁：如果多个事务同时需要访问相同的一组数据，但是它们的访问顺序不同，就可能会出现死锁的情况。例如，事务A锁定了数据1，然后请求锁定数据2，而事务B则锁定了数据2，然后请求锁定数据1，这样就会造成死锁。
4. 性能问题：由于每个事务必须等待其他事务完成之后才能访问数据，所以并发事务可能会导致数据库系统的性能下降。

为了解决并发事务带来的问题，可以使用事务隔离级别等，来保证数据的一致性，可靠性和并发性能。

### 4. 数据库事务隔离级别

数据库事务隔离级别是指在并发事务中，一个事务的修改结果何时对其他事务可见的级别。常见的数据库事务隔离级别包括：

1. 读未提交：一个事务可以读取另一个事务还未提交的数据，可能会出现脏读、不可重复读和幻读的问题。
2. 读已提交：一个事务只能读取另一个已经提交的事务的数据，可以避免脏读的问题，但是可能会出现不可重复读和幻读的问题。
3. 可重复读：一个事务在执行期间多次读取同一个数据集合时，能够保证读取到相同的数据，可以避免脏读和不可重复的问题，但是可能会出现幻读的问题。
4. 串行化：最高的隔离级别，事务之间完全串行执行，可以避免脏读、不可重复读和幻读的问题，但是会降低并发性能。

不同的隔离级别之间，对事务的并发性能和数据的一致性有不同的影响。因此，在实际应用中，需要根据具体情况选择合适的隔离级别，以兼顾并发性能和数据的一致性。

### 5. mysql引擎对比

1. InnoDB引擎

   InnoDB是Mysql5.6版本的默认存储引擎，它支持事务、行级锁和外键约束等功能，适用于高并发，高可靠性的应用场景。相较于MyISAM引擎，InnoDB支持更好的事务处理能力和更高的数据完整性保证，但是在并发读写性能方面略逊于MyISAM。

2. MyISAM引擎

   MyISAM是MySQL的另一种常用存储引擎，它不支持事务和行级锁，但是在并发读写性能方面表现出色，适用于读频繁，写少的应用场景。由于不支持事务，因此在数据完整性保证方面要比InnoDB差。

3. Memory引擎

   Memory存储引擎将数据存储在内存中，因此具有快速的读写速度，适用于对性能要求较高的应用场景，比如缓存，会话管理等。由于数据存储在内存中，因此不支持大数据量，长时间存储，也不支持事务和外键约束等功能。

4. NDB Cluster引擎

   NDB Cluster是Mysql的一种分布式存储引擎，他将数据分散存储在多台服务器上，具有高可用性、高并发、高可扩展性等特点，适用于需要大规模数据存储和高可用性的应用场景。但是在性能方面可能不如InnoDB或MyISAM。

### 6. 关系型和非关系型数据库的区别

关系型数据库的优点：

- 容易理解，因为他采用了关系模型来组织数据
- 可以保证数据的一致性
- 数据更新的开销比较小
- 支持复杂查询

非关系型数据库的优点：

- 无需经过SQL层的解析，读写效率高
- 基于键值对，读写性能很高，易于扩展
- 可以支持多种类型数据的存储，如图片，文档等

### 7. 索引的类型

1. 从数据结构角度
   1. 树索引
   2. Hash索引
2. 从物理存储角度
   1. 聚集索引
   2. 非聚集索引
3. 从逻辑角度
   1. 普通索引
   2. 唯一索引
   3. 主键索引
   4. 联合索引

### 8.值为NULL时，查询是否会用到索引？

在mysql里null值得列也是走索引得。当然，如果计划对列进行索引，就要尽量避免把它设置成空，mysql难以优化引用了空列得查询，它会使索引、索引统计和值更加复杂。

### 9. drop、delete、truncate的区别？

在mysql中呢，drop、delete、truncate都是用于删除数据的命令，但他们之间有不同的使用场景和行为

drop命令可以删除整个表，包括表结构和数据，使用方式呢是drop table tablename，使用drop命令会永久性的删除表，且不可恢复，因此在使用之前应该非常小心。

delete命令用于删除表中的行，使用方式为delete from tablename，使用delete命令时，可以在where子句中指定要删除的行的条件，delete命令于drop不同，delete命令只删除表中的数据，而不删除表本身。

truncate命令也可以删除表中的数据，使用方式为truncate table tablename。与delete不同的是，truncate命令删除表中的所有行，但是保留表的结构。在执行truncate命令时，表上的所有索引和依赖关系也会被删除，并且表中的自增长计数器将被重置。与drop类似，也是一种永久性的删除方式。

### 10. varchar与char的区别以及varchar(50)中的50代表的含义？

varchar与char的区别是char是一种固定长度的类型，varchar则是一种可变长度的类型。

varchar(50)中50的含义是最多存放50个字符，varchar(50)和(200)存储hello所占空间一样，但是后者在排序时会消耗更多内存，因为order by col采用fixed_length计算col长度。

### 11. int(10)和bigint(10)能存储的数据大小一样吗？

不一样，因为int能存储四字节有符号整数，而bigint能存储八字节有符号整数。所以能存储的数据大小不一样，其中的数字 10 代表的只是数据的显示宽度。

### 12.为什么innoDB存储引擎选用B+树而不是B树？

InnoDB存储引擎选择使用B+树而不是B树，主要时为了提高查询性能和数据读取效率，并解决B树在磁盘存储上的不足。

而B+树相比B树来说，有很多优势，比如：

1. 减少磁盘I/O次数：B+树的非叶子节点只包含索引信息，而不包含数据信息，数据只存储在叶子节点中，因此在进行范围查询时，只需要遍历叶子节点即可，减少了磁盘I/O次数。
2. 提高查询效率：B+树的叶子节点形成一个有序链表，可以快速进行区间查询、排序等操作。
3. 提高磁盘存储空间利用率：B+树的叶子节点都是存储数据的，因此可以使用更大的块大小进行存储，减少了磁盘碎片，提高了存储空间利用率。
4. 适合顺序访问：B+树的数据存储在叶子节点上，可以通过链表顺序访问，适合大量顺序访问的场景，如表扫描。

### 13. 说一下Mysql的行锁和表锁？

MyISAM只支持表锁，InnoDB支持表锁和行锁，默认为行锁。

表锁：开销小，加锁快，不会出现死锁。锁定粒度大，发送锁冲突的概率最高，并发量最低。

行锁：开销大，加锁慢，会出现死锁。锁粒度小，发生锁冲突的概率小，并发度最高。

### 14. Mysql数据库cpu飙升到500%的话他怎么样处理？

可能是因为数据库服务器正在处理大量的并发请求，或者某些查询或操作导致了CPU使用率的异常增加。

处理方法：

1. 检查Mysql进程列表和状态：可以使用top命令或其他系统的监控工具查看mysql进程的cpu占用情况，以及其他系统资源的使用情况，如果发现某个查询或操作占用了大量的cpu时间，可以考虑取消该操作或者优化查询语句。
2. 检查Mysql配置参数：可以检查mysql的配置参数是否合理，例如缓冲区大小、并发连接数等。调整这些参数可能有助于减少cpu使用率。
3. 优化查询语句：可以使用EXPLAIN命令分析查询语句的执行计划，查看是否存在慢查询或者查询语句需要优化的情况。优化查询语句可能有助于减少CPU使用率。
4. 增加硬件资源：如果服务器的CPU、内存等硬件资源不足，可以考虑增加硬件资源。扩展服务器的硬件资源可能有助于减少CPU使用率。
5. 升级Mysql版本：如果使用的是较旧的mysql版本，可以考虑升级较新的版本。较新的Mysql版本可能会优化查询执行计划，提高查询性能，从而减少CPU使用率。

### 15. Mysql问题排查都有哪些手段？

1. 使用show processlist命令查看当前所有连接信息
2. 使用Explain命令查询sql语句执行计划
3. 开启慢查询日志，查看慢查询的sql

### 16. Mysql主从复制流程是怎样的？

mysql主从复制是一种常见的数据库复制技术，可以将一个mysql主服务器上的数据复制到一个或多个从服务器上。

那么整个流程首先是：

1. 配置主服务器：在主服务器上开启二进制日志，并配置唯一的服务器id，二进制日志记录了所有对数据库的修改操作。
2. 配置从服务器：在从服务器上配置唯一的服务器id，并指定主服务器的ip地址和端口号。
3. 启动从服务器：在从服务器上启动mysql进程，并指定从服务器要复制的主服务器的信息。
4. 从主服务器复制数据：从服务器连接到主服务器，并请求复制数据，主服务器将二进制日志中的数据逐步发送给从服务器。
5. 应用复制数据：从服务器接收到主服务器的数据后，将其应用到自己的数据库中。从服务器的数据会与主服务器保持同步，当主服务器有新的修改操作时，从服务器也会相应的进行修改。
6. 监控复制状态：可以使用Mysql自带的show slave status命令监控从服务器的复制状态，包括复制延迟，错误信息等。



